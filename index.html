<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Species Identifier</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <h1>Species Identification Table</h1>
  <iframe src="species-table.html" width="100%" height="600px" style="border: none;"></iframe>

  <script>
    function initializeScripts() {
      const iframe = document.querySelector("iframe");
      iframe.addEventListener("load", () => {
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

        // Activate webcam in iframe
        const video = iframeDoc.getElementById("camera");
        if (video) {
          navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
              video.srcObject = stream;
              video.play();
            })
            .catch(err => console.error("Camera access error:", err));
        }

        // Hook up identify buttons (placeholder behavior for now)
        iframeDoc.querySelectorAll(".identify-btn").forEach(btn => {
          btn.addEventListener("click", () => {
            const row = btn.closest("tr");
            const speciesInput = row.querySelector(".species-name");
            // Placeholder: mimic species ID
            speciesInput.value = "Common Starling";
          });
        });

        // Date button logic
        iframeDoc.querySelectorAll(".date-btn").forEach(btn => {
          btn.addEventListener("click", () => {
            const row = btn.closest("tr");
            const dateInput = row.querySelector(".date");
            const today = new Date().toISOString().split("T")[0];
            dateInput.value = today;
          });
        });

        // Location button logic
        iframeDoc.querySelectorAll(".location-btn").forEach(btn => {
          btn.addEventListener("click", () => {
            const row = btn.closest("tr");
            const placeInput = row.querySelector(".place");
            navigator.geolocation.getCurrentPosition(
              position => {
                const { latitude, longitude } = position.coords;
                placeInput.value = `${latitude.toFixed(5)}, ${longitude.toFixed(5)}`;
              },
              err => {
                console.error("Geolocation error:", err);
                placeInput.value = "Location unavailable";
              }
            );
          });
        });

        // Submit button logic
        iframeDoc.querySelectorAll(".submit-btn").forEach(btn => {
          btn.addEventListener("click", () => {
            const row = btn.closest("tr");
            const username = row.querySelector(".username").value;
            const species = row.querySelector(".species-name").value;
            const date = row.querySelector(".date").value;
            const place = row.querySelector(".place").value;

            console.log("Submitted:", {
              username,
              species,
              date,
              place
            });

            alert(`Submitted: ${species} by ${username}`);
          });
        });
      });
    }

    window.onload = initializeScripts;
  </script>
</body>
</html>
